
linux 操作手册

http://www.runoob.com/linux/linux-command-manual.html

安装
## 安装上传下载的命令 -y：一直同意
	yum -y install lrzsz

	解压activeMq
	tar -zxcf apache-activemq-5.14.0-bin.tar.gz 
	解压并安装Java
	tar -zxvf jdk-8u191-linux-x64.tar.gz

##  修改环境变量 
	### sudo命令以系统管理者的身份执行指令，也就是说，经由 sudo 所执行的指令就好像是 root 亲自执行。http://www.runoob.com/linux/linux-comm-sudo.html
	sudo vi /etc/profile  以管理员角色来打开profile文件
			#Java Env Java环境变量Linux配置
			export JAVA_HOME=/usr/local/src/jdk1.8.0_191
			export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
			export PATH=$PATH:$JAVA_HOME/bin
			export JRE_HOME=$JAVA_HOME/jre
	source /etc/profile   生效配置文件

	# 如果安装的程序访问不了，需要给对应的端口开防火墙
	/sbin/iptables -I INPUT -p tcp --dport 1883 -j ACCEPT
	/sbin/iptables -I INPUT -p tcp --dport 61616 -j ACCEPT
	/sbin/iptables -I INPUT -p tcp --dport 8161 -j ACCEPT
	##重启防火墙
	/etc/rc.d/init.d/iptables save
	/etc/rc.d/init.d/iptables restart
	/etc/init.d/iptables status

## 查看端口占用
	netstat -anp|grep 61616
	
	// 查看8356有效连接数
	netstat -anp | grep 7002 |grep ESTABLISHED| wc -l
	
	netstat -ant | awk '/tcp/ {print $6}'|sort |uniq -c |sort -nr
	

## ps将某个进程显示出来 显示java的进程
	ps -ef |grep java			//显示所有命令，连带命令行
	ps -aux |grep java       	//-aux 显示所有包含其他使用者的行程

## 查看海康ac开头程序的状态
	systemctl status hik.@bic.notify*
	systemctl status hik.ac*
	systemctl restart hik.ac*   重启服务
	systemctl restart wrapper   重启服务   

##显示文件夹大小 sort是排序
	du -h|sort -nr
	ls -lh  文件大小按kb、M来展示   
	ll 显示文件大小展示

## 给文件赋权限	
chmod 777 -R *

##查看服务状态
	systemctl status hik.@bic.notify.1|grep active| head -n1 | awk {'print $3'} | cut -d '(' -f2 | cut -d ')' -f1

##ssh root 连接不上的情况：
	sudo vi /etc/ssh/sshd_config 修改 PermitRootLogin 改成yes
	重启 sshd 服务 sudo /bin/systemctl restart sshd.service

	linux 为了保护核心文件root没有开启 通过下面方式设置
	sudo passwd root 回车
	(输入密码,但不会在屏幕显示出*)
	(再输入一次密码)
	然后 root 登陆
	
## Linux本机localhost
	vim /etc/hosts
	
## 查看磁盘空间使用情况	
	df -hl /opt/

## 查看文件夹大小		
	du -sh * | sort -n 
	
## java运行jar
	java -jar demo.jar --server.port=9090
	java -jar demo.jar --server.port=7002
	"D:\hikvision\web\opsMgrCenter\bin\notify\..\..\bin\jre\bin\java.exe" -jar portMock.jar

## Linux 搜索文件命令
	在home目录下面搜索 名字为elm.cc的文件
	find /home/ -name elm.cc
	
## 设置idea JVM运行参数（内存溢出时打出dump）
	-Xms50m  -Xmx50m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=E:dump\hello.hprof

## tomcat 添加远程调试参数
	declare -x CATALINA_OPTS="-server -Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005"	
	JVM 添加远程调试参数（下面一行是不需要用户名密码验证）
	-Dcom.sun.management.jmxremote.port=8989 -Djava.rmi.server.hostname=10.19.128.118 
	-Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false

## Linux 修改时间
	date -s  完整日期时间（YYYY-MM-DD hh:mm[:ss]）：修改日期、时间	

## Linux删除文件夹( r 递归 f 强制删除)
	rm -rf /var/log/httpd/access	

## Linux复制文件
	复制文件夹 （r 表示递归 f 表示不提示）
	cp -rf $HOME_DIR/tools/jre18linux64.1 /opt/jre18linux64.1
	拷贝文件（拷到对应的目录下面去）
	cp -rf  /opt/tool/文档/高可用部署cluster步骤.docx  /opt
	如果文件存在仍会提示
	\cp -rf  /opt/tool/文档/高可用部署cluster步骤.docx  /opt

amq Linux环境环境安装失败：

原因：
	由于Linux下 通过java -cp 执行多个jar的时候路径分隔符使用了“;”(由于Windows下使用“;”分割，所以很容易被误导)
	Linux下多个jar路径应该通过“:”进行分割
	
错误事例：
	$JAVA "-DAMQ_COMPATH=$HOME" -DVERSION=activemq514linux64 -cp "$HOME/tool/lib/*;$HOME/tool/lib/lib/*" "$CLSNAME"
	
正确命令：
	$JAVA "-DAMQ_COMPATH=$HOME" -DVERSION=activemq514linux64 -cp "$HOME/tool/lib/*:$HOME/tool/lib/lib/*" "$CLSNAME" 

## 检查防火墙是否安装
	rpm -qa|grep iptables
	
	systemctl stop firewalld.service

	配置命令：
	firewall-cmd --permanent --add-port=8161/tcp
	firewall-cmd --reload

	查看配置结果命令，看结果中的ports是否有添加的端口：
	firewall-cmd --list-all


	去掉命令：?
	firewall-cmd --permanent --remove-port=8162/tcp
	firewall-cmd --reload? 

## 强制杀死进程 （9538 进程号）
	kill -s 9 9538
	
git的时候出现问题SSL Error: unable to get local issuer certificate
跳过ssh验证
git config --global http.sslVerify false

linux 下操作dump文件

1. dump (heap dump , thread dump)  
	./jcmd pid GC.heap_dump >/opt/hikvision/web/opsMgrCenter/logs/opsmgr_notify/notify.hprof
	./jcmd pid Thread.print 

	dump 
	./jcmd 61990 GC.heap_dump /opt/opsmgr/web/components/activemq514linux64.1/amq.hprof
	
windump
jcmd pid Thread.print	
jcmd pid GC.heap_dump D:\notify.hprof
	
psexec -s "D:\D:\Program Files\hikvision\web\components\jre18win64.1\bin\jcmd.exe" 34844 Thread.print >D:/aa.txt	
	
/usr/lib/systemd/system
	
ExecStart=/opt/opsmgr/web/opsMgrCenter/bin/notify/activemq514win64/bin/linux-x86-64/activemq start
ExecStop=/opt/opsmgr/web/opsMgrCenter/bin/notify/activemq514win64/bin/linux-x86-64/activemq stop

抓包
tcpdump -i lo -nn tcp port 7002|grep "> 10.2.145.79.7002"|awk -F " " '{print $3}'|awk -F "." '{cmd="lsof -i :"$5;system(cmd)}' 

	
	
2. 看看监控页面是否可以访问,保存当时的kahadb,localhost(临时存储)   
3. 保存当时日志 


SSL证书命令
	
	#根据keystore为证书
	keytool -export -alias 1 -keystore activemq514win64_server.jks -file amq_server.crt
	# 根据根证书导出ts
	keytool -import -file amq_server.crt -keystore client_root.ts -alias 1

	keytool -import -v -trustcacerts -alias root111  -file ./root.crt -storepass changeit -keystore ./cacerts
	keytool -import -v -trustcacerts -alias root111  -file ./root.crt -storepass changeit -keystore ./cacerts 
	
	### jmeter证书导入 root.crt 导入
	keytool -import -v -trustcacerts -alias root127  -file ./root.crt -storepass changeit -keystore ./cacerts
	### cacerts 拷到 jre1.8.0_191\lib\security
	
	
查看服务器网络情况
	测试网络情况，使用iperf3

	yum install iperf3

	https://iperf.fr/

	iperf3 Cs

	iperf3 -c 10.66.164.35


systemctl daemon-reload
systemctl restart [servicename] 
